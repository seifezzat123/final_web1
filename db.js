const sqlite = require('sqlite3');
const db = new sqlite.Database('3alegny.db');



const createUserTable = `CREATE TABLE IF NOT EXISTS USER (
  ID INTEGER PRIMARY KEY AUTOINCREMENT,
  NAME TEXT,
  EMAIL TEXT UNIQUE NOT NULL,
  ROLE TEXT NOT NULL,
  PASSWORD TEXT NOT NULL
)`;

const createAddressTable = `CREATE TABLE IF NOT EXISTS ADDRESS (
  ID INTEGER PRIMARY KEY AUTOINCREMENT,
  USER_ID INTEGER NOT NULL,
  STREET TEXT NOT NULL,
  BUILDING TEXT NOT NULL,
  FLOOR TEXT NOT NULL,
  APARTMENT TEXT NOT NULL,
  FOREIGN KEY (USER_ID) REFERENCES USER(ID) ON DELETE CASCADE
)`;

const createMedicineTable = `CREATE TABLE IF NOT EXISTS MEDICINE (
  ID INTEGER PRIMARY KEY AUTOINCREMENT,
  USER_ID INTEGER NOT NULL,
  NAME TEXT NOT NULL,
  PRICE REAL NOT NULL,
  STOCK INTEGER NOT NULL,
  EXPIRY_DATE TEXT,
  DESCRIPTION TEXT,
  FOREIGN KEY (USER_ID) REFERENCES USER(ID) ON DELETE CASCADE
)`;

const createCartTable = `CREATE TABLE IF NOT EXISTS CART (
  ID INTEGER PRIMARY KEY AUTOINCREMENT,
  USER_ID INTEGER NOT NULL,
  MEDICINE_ID INTEGER NOT NULL,
  QUANTITY INTEGER NOT NULL,
  CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (USER_ID) REFERENCES USER(ID) ON DELETE CASCADE,
  FOREIGN KEY (MEDICINE_ID) REFERENCES MEDICINE(ID) ON DELETE CASCADE
)`;

const createOrderTable = `CREATE TABLE IF NOT EXISTS ORDER_TABLE (
  ID INTEGER PRIMARY KEY AUTOINCREMENT,
  USER_ID INTEGER NOT NULL,
  ADDRESS_ID INTEGER NOT NULL,
  CART_ID INTEGER NOT NULL,
  TOTAL_PRICE REAL NOT NULL,
  STATUS TEXT DEFAULT 'pending',
  CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (USER_ID) REFERENCES USER(ID) ON DELETE CASCADE,
  FOREIGN KEY (ADDRESS_ID) REFERENCES ADDRESS(ID),
  FOREIGN KEY (CART_ID) REFERENCES CART(ID)
)`;

const createFeedbackTable = `CREATE TABLE IF NOT EXISTS FEEDBACK (
  ID INTEGER PRIMARY KEY AUTOINCREMENT,
  USER_ID INTEGER NOT NULL,
  ORDER_ID INTEGER NOT NULL,
  ORDER_QUALITY INTEGER NOT NULL,
  DELIVERY_RATING INTEGER NOT NULL,
  COMMENTS TEXT,
  CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (USER_ID) REFERENCES USER(ID) ON DELETE CASCADE,
  FOREIGN KEY (ORDER_ID) REFERENCES ORDER_TABLE(ID) ON DELETE CASCADE
)`;

module.exports = {
  db,
  createUserTable,
  createAddressTable,
  createMedicineTable,
  createCartTable,
  createOrderTable,
  createFeedbackTable,
};